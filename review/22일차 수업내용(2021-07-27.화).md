## 22일차 수업내용(2021-07-27.화)

OOP ex03

인스턴스 변수(필드) = non-static 변수(필드)

- boolean  변수타입은 4byte
  - 배열은 바이트타입으로

offset = 상대적인주소

설계도에따라 생성된 변수 = 인스턴스(instance) = 객체

클래스안에 아무것도 없다고 하더라도 기본적으로 부가정보를 담고있는 부가변수는 만들어진다.new설계도로 만들면 생성은된다.

#### 클래스 변수(필드) = static 변수(필드)



인스턴스변수를 가리킬 때는 this를 반드시 붙여야 한다. 단! 생략할수는 있지만 무조건 붙힌다고 생각하자.

좌우명과 가치관 미리 생각해놓기

나의 미션은?

인스턴스를 생성할 때 무조건 생성자를 호출하게 된다.

파라미터가 없는 생성자를 기본생성자라고 한다.

this = 생성된 인스턴스의 주소

생성자가 한 개라도 있으면 컴파일러는 기본 생성자를 만들어주지 않는다.

인스턴스 변수를 만든후 생성자를 호출할때 생성자의 파라미터 값의 순서와 타입을 정확히 입력해야한다.



#### 변수 자동 초기화 ex03.0510~0530

**클래스 변수(static 변수)**

- 클래스 변수(스태틱 변수)는 생성되는 순간 0으로 자동 초기화 된다.

**인스턴스 변수(non-static변수)**

- 힙(heap)에 생성되는 인스턴스 필드(변수)는 자동으로 초기화된다.
- 인스턴스 필드(변수)는 생성되는 즉시 0으로 초기화 된다.
  - 정수(byte, short, int, long, char) : 0
  - 부동소수점(float, double) : 0.0 = 0
  - 논리(boolean) : false = 0
  - 레퍼런스: null = 0

**로컬 변수**

- 로컬 변수는 자동으로 초기화되지 않는다.
- 반드시 변수를 사용하기 전에 초기화 시켜야 한다.
- 초기화하지 않은 로컬 변수는 사용할 수 없다.

**초기화란?**

- 값을 한 번이라도 저장하는 것!



#### 스태틱 초기화 블록(static initializer) - 레퍼런스 선언

- 스태틱 블록은 여러개의 블록을 만들어도 컴파일할때 한개의 블록으로 합쳐진다!
  - 스태틱 블록을 여러개 만들려고 하지 말자 하나로합쳐서 만들자!
  - 스태틱블록은 클래스가 로딩 될때 실행된다.
    - 또는 스태틱멤버가 사용될때


- **클래스파일은 중복로딩 되지 않는다. 처음 1번만 로딩된다!**

- 클래스가 로딩되는 경우)

  - 1) 클래스 멤버(필드와 메서드)를 최초로 사용할 때
  - 2) 클래스 멤버(필드와 메서드)를 최초로 사용할 때
  - 3) 해당 클래스의 인스턴스를 최소로 생성할 때
    - 인스턴스를 만들려면 설계도가 있어야 하고,
    - 설계도는 메모리에 로딩되어 있어야 한다.
    - 따라서 설계도가 없으면 즉시 설계도를 로딩할 것이다.
  - 4) 자바에서 제공하는 도구를 사용하여 클래스를 로딩할 때,
    - 이미 클래스가 로딩되어 있다면 다시 로딩하지 않는다.
    - 메모리 절약을 위해, 자바는 중복해서 클래스를 메모리에 로딩하지 않는다.

- **클래스가 로딩 될 때 초기화 블록은 실행된다.**

- 클래스가 로딩된 후

  - 1) 클래스 필드가 생성된다.
  - 2) 클래스 블록(스태틱 블록)이 실행된다.
    - 레퍼런스를 선언 할 때는 클래스가 로딩 되지 않는다.

- **스태틱 초기화 블록(static initializer) - 변수 초기화 문장(variable initializer)**

  - 변수 초기화 문장(variable initializer)을 컴파일 할 때,

    - 스태틱 초기화 블록이 없으면 컴파일러가 자동으로 삽입한다.
    - 스태틱 초기화 블록에 a 에 100을 할당하는 문장을 삽입한다.
    - 밑의 코드와 같이 바뀐다.

  - ``` java
    public static class A {
        static int a = 100;
    } // 위에 코드처럼 초기화 문장을 선언 했다고 하더라도,
      // static int a;
      //    static {
      //      a = 100;
      //    }
      // 클래스 파일의 스태틱 블록은 위의 코드처럼 실행된다.
    ```

- 변수 초기화 문장(variable initializer)을 컴파일 과정

  - 일단 모든 스태틱 필드를 먼저 만든다.
  - 스태틱 변수 초기화 문장을 스태틱 블록으로 옮긴다.
  - 스태틱 블록 모두 순서에 따라 한 스태틱 블록에 합친다.
  - 즉, 스태틱 변수 초기화 문장과 스태틱 블록을 구분하지 않고 선언된 순서대로 하나의 스태틱 블록에 합친다.

- ` 스태틱 블록은 클래스 멤버를 사용하기 전에 유효한 값으로 초기화시키는 것. `

- ex03.Exam0691 예제 실행 순서

- ``` java
  package com.eomcs.oop.ex03;

  public class Exam0691 {

    static class A {
      static int a = 7;

      static {
        System.out.println("A.static{}");
        a += B.b;
      }
    }

    static class B {
      static int b = 22;

      static {
        System.out.println("B.static{}");
        b += A.a;
      }
    }
    
    public static void main(String[] args) {
      System.out.println(A.a); // ?
      System.out.println(B.b); // ?
    }
  }
  // 1) Exam0691의 클래스 파일을 Method Area영역에 로딩시킨다.
  // 2) 클래스 파일의 main()메인메서드를 호출한다.
  // 3) 메인 메서드 안의 로컬 변수를 생성시킨다 위의코드상으로) 
  //  - args <=변수가생성(JVMstack)에 생성
  // 4) 메인메서드안에 코드를 실행 첫번째 콘솔을 출력하기 위해서  
  ```



#### 인스턴스 초기화 블록(initializer block) - 인스턴스 초기화 블록

- 스태틱이 안붙으면 인스턴스 초기화 블록

- 인스턴스 블록은 스태틱처럼 초기화 블록이 만들어지지 않는다.

- 인스턴스 초기화 블록은 생성자 시작부분에 삽입된다.

- 여러 개의 생성자가 있으면, 

  - 인스턴스 초기화 블록 코드는 존재하는 모든 생성자의 앞 부분에 삽입된다.

- 인스턴스 초기화 블록이 선언된 위치는 상관없다.

- 인스턴스 초기화 블록은 위치에 상관없이 선언된 순서대로 삽입한다.

- **인스턴스 초기화 블록의 용도**

  - 1) 여러 생성자에 공통으로 들어가는 초기화 문장을 작성할 때
  - 2)  생성자를 만들지 못하는 상황에서 복잡한 로직에 따라
    - 인스턴스 필드를 초기화시켜야 할 때

- 인스턴스 초기화 블록은 여러개 만들 필요가 없다. 어차피 초기화 블럭은 차례대로 삽입되는데,

  - 굳이 여러개를 안만들고 한블럭안에 다 삽입 해도 된다.

- ``` java
  package com.eomcs.oop.ex03;

  public class Exam0750 {

    static class A {
      int a;
      int b;
      int c;

      // 여러 개의 인스턴스 초기화 블록이 있을 때,
      // - 선언된 순서대로 생성자의 앞 부분에 삽입된다.
      // - 인스턴스 초기화 블록이 선언된 위치는 상관없다.
      // - 바이트코드(Exam0750$A.class)를 확인해 보라!
      {
        this.a = 101;
        System.out.println("첫 번째 인스턴스 초기화 블록");
      }

      A() {
        // 인스턴스 초기화 블록은 위치에 상관없이 선언된 순서대로 삽입한다.
        // 즉 다음과 같다.
        // this.a = 101;
        // System.out.println("첫 번째 인스턴스 초기화 블록");
        // this.a = 102;
        // System.out.println("두 번째 인스턴스 초기화 블록");
        // this.a = 103;
        // System.out.println("세 번째 인스턴스 초기화 블록");

        System.out.println("A()");
        b = 200;
        c = 300;
      }

      {
        this.a = 102;
        System.out.println("두 번째 인스턴스 초기화 블록");
      }

      {
        this.a = 103;
        System.out.println("세 번째 인스턴스 초기화 블록");
      }
    }

    public static void main(String[] args) {
      A obj1 = new A();
      System.out.printf("a=%d, b=%d, c=%d\n", obj1.a, obj1.b, obj1.c);
    }
  }
  ```